#!/usr/bin/env python
import sys
import sqlite3

def get_bags():
	bags = {}
	bags["BTC"] = 1.261
	try:
		con = sqlite3.connect("db.sqlite")
		con.row_factory = sqlite3.Row
		cur = con.execute("SELECT * FROM transactions;")
		for row in cur:
			sym = row['pair']
			sym = sym.split("_")[0]
			amnt = row['amount']
			price = row['price']
			action = row['action']
			if sym == "BTC":
				continue
			if sym not in bags:
				bags[sym] = 0.0
			if action == "BUY":
				bags["BTC"] -= (price * amnt)
				bags[sym] += amnt
			if action == "SELL":
				bags["BTC"] += (price * amnt)
				bags[sym] -= amnt
		con.close()
	except e:
		print e
		sys.exit(1)
	return bags

if __name__ == "__main__":
	bags = get_bags()
	keys = bags.keys()
	keys.sort()
	for k in keys:
		print k, "\t=>\t", bags[k]
